@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Layouts.cshtml";
    IEnumerable<BTS.Web.Models.OperatorViewModel> operators = ViewBag.operators;
    IEnumerable<BTS.Web.Models.ProfileViewModel> profiles = ViewBag.profiles;
    IEnumerable<string> years = ViewBag.years;
}

@section footerJS{
    
     <!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
        integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>    

    @*<script src="~/Assets/admin/libs/leaflet/dist/leaflet.js"></script>*@
    <script src="~/Assets/admin/libs/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="~/Assets/client/map/leaf-demo.js"></script>
    <script src="~/Assets/admin/libs/moment/moment.js"></script>
    <script>
        $(function () {
            $('body').on('shown.bs.modal', function (e) {
                setTimeout(function () { map.invalidateSize() }, 500);
            })

            $("#admin-data-table-2").dataTable({
                "processing": true,
                "info": true,
                "selector": true,
                "ajax": {
                    "url": "/Certificate/loadCertificate",
                    "type": "POST",
                    "data": function (d) {
                        d.Year = $('#IssueYear').val().trim();
                        d.OperatorID = $('#OperatorID').val().trim();
                        d.ProfileID = $('#ProfileID').val().trim();
                    }
                },
                "columns": [
                    { "data": "ID", "name": "ID", "autoWidth": true },
                    { "data": "OperatorID", "name": "OperatorID", "autoWidth": true },  // index 1
                    { "data": "BtsCode", "name": "BtsCode", "autoWidth": true },        // index 2
                    {
                        "data": "IssuedDate", "name": "IssuedDate", "autoWidth": true,  // index 3
                        "render": function (data, type, row) {
                            return (moment(row["IssuedDate"]).format("DD/MM/YYYY"));
                        }
                    },
                    {
                        "data": "ExpiredDate", "name": "ExpiredDate", "autoWidth": true, // index 4
                        "render": function (data, type, row) {
                            return (moment(row["ExpiredDate"]).format("DD/MM/YYYY"));
                        }
                    }]

            });

            //Apply custom Search on dataTable here
            var oTable2 = $('#admin-data-table-2').DataTable();
            $('#btnSearch').click(function () {
                oTable2.ajax.reload();
                if (map != undefined && map != null && markerClusters != null) {
                    map.removeLayer(markerClusters);
                    //map.eachLayer(function (layer) {
                    //    map.removeLayer(layer);
                    //});
                }
            });
        });
    </script>
}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Data Tables
            <small>advanced tables</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
            <li><a href="#">Tables</a></li>
            <li class="active">Data tables</li>
        </ol>
    </section>

    <!-- Main content -->

    <section class="content">
        <div class="row col-md-12">
            <!-- SELECT2 EXAMPLE -->
            <div class="box box-default col-md-8">
                <div class="box-header with-border">
                    <h3 class="BTS-title">LỌC GIẤY CHỨNG NHẬN KIỂM ĐỊNH</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i></button>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="clearfix"></div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <form id="demo-form2" data-parsley-validate class="form-horizontal form-label-left">
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="issueYear">
                                        Năm cấp GCNKĐ<span class="required"></span>
                                    </label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <select id="IssueYear" class="form-control selectYear" style="width: 60%;">
                                            <option value="" selected="selected">Tất cả</option>
                                            @foreach (var item in years)
                                            {
                                            <option @(DateTime.Today.Year.ToString() == @item) ? selected="selected" value="@item">@item</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="OperatorID">
                                        Nhà mạng<span class="required"></span>
                                    </label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <select id="OperatorID" class="form-control selectYear" style="width: 80%;">
                                            <option value="" selected="selected">Tất cả</option>
                                            @foreach (var item in operators)
                                            {
                                            <option value="@item.ID">@item.ID _ @item.Name</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="ProfileID">
                                        Hồ sơ nộp<span class="required"></span>
                                    </label>
                                    <div class="col-md-6 col-sm-6 col-xs-12">
                                        <select id="ProfileID" class="form-control selectYear" style="width: 100%;">
                                            <option value="" selected="selected">Tất cả</option>
                                            @foreach (var item in profiles)
                                            {
                                            <option value="@item.ID">@item.BtsQuantity BTS _ @item.ApplicantID _ @item.ProfileNum</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="ln_solid"></div>
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                        <button class="btn btn-primary" type="reset">Bỏ lọc</button>
                                        <input class="btn btn-success" type="button" id="btnSearch" value="Tìm kiếm" />
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- /.box-body -->
                <div class="box-footer">
                </div>
            </div>
            <!-- /.box -->
        </div>

        <ul class="nav nav-tabs nav-pills">
            <li class="active"><a data-toggle="tab" href="#homeTab">Danh sách GCNKĐ</a></li>
            <li><a data-toggle="tab" href="#mapTab">Xem trên Bản đồ</a></li>
            <li><a data-toggle="tab" href="#menu2">Số liệu thống kê</a></li>
        </ul>
        <div class="tab-content">
            <div id="homeTab" class="tab-pane fade in active">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="BTS-title">DANH SÁCH GIẤY CHỨNG NHẬN KIỂM ĐỊNH ĐÃ BAN HÀNH</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">

                                <table id="admin-data-table-2" class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>OperatorID</th>
                                            <th>BtsCode</th>
                                            <th>IssuedDate</th>
                                            <th>ExpiredDate</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                    <!-- /.col -->
                </div>
            </div>
            <div id="mapTab" class="tab-pane fade">
                <h3 class="BTS-title">DANH SÁCH CÁC TRẠM BTS ĐÃ ĐƯỢC CẤP GIẤY CHỨNG NHẬN KIỂM ĐỊNH</h3>
                <div id="mapBTS" style="width: 100%; height: 500px;"></div>
            </div>
            <div id="menu2" class="tab-pane fade">
                <h3>Menu 2</h3>
                <p>Some content in menu 2.</p>
            </div>
            <!-- /.row -->
    </section>
</div>